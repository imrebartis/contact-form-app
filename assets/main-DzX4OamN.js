var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s);import{T as n,p as s,v as r}from"./vendor-n-WUl7CN.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class i{static getElement(e,t={throwIfNotFound:!0}){let n=null,s="";if("string"==typeof e)n=document.querySelector(e),s=`Element not found: ${e}`;else if("id"in e)n=document.getElementById(e.id),s=`Element not found with ID: ${e.id}`;else if("form"in e&&"name"in e){n=e.form.elements.namedItem(e.name),s=`Element not found with name: ${e.name} in form`}if(!n&&t.throwIfNotFound)throw new Error(t.errorMessage||s);return n}static getElements(e,t={throwIfNotFound:!1}){const n=Array.from(document.querySelectorAll(e));if(0===n.length&&t.throwIfNotFound)throw new Error(t.errorMessage||`No elements found: ${e}`);return n}static getElementById(e,t={throwIfNotFound:!1}){return this.getElement({id:e},t)}static getElementByName(e,t,n={throwIfNotFound:!1}){return this.getElement({form:e,name:t},n)}static getErrorContainer(e,t){return"queryType"===e?document.querySelector(".radio-group"):t}static addEventListener(e,t,n,s){e.addEventListener(t,n,{signal:s})}static removeEventListener(e,t,n){e.removeEventListener(t,n)}static showError(e,t){this.setAriaInvalid(e,!!t);const n=this.findErrorElement(e);n&&this.updateErrorElement(n,t)}static setAriaInvalid(e,t){const n=t?"true":"false";if(e.classList.contains("radio-group")||e.classList.contains("checkbox-container")){e.querySelectorAll("input").forEach((e=>e.setAttribute("aria-invalid",n)))}else e.setAttribute("aria-invalid",n)}static findErrorElement(e){const t=e.getAttribute("aria-describedby");if(t)return this.getElementById(t);if(e.classList.contains("radio-group")||e.classList.contains("checkbox-container")){const t=e.querySelector(".error-message");if(t)return t}const n=e.closest(".form-field")||e.parentElement;return n&&n.querySelector(".error-message")||null}static setElementVisibility(e,t,n="block",s=!1,r="visible",i="hidden"){e.style.display=t?n:"none",e.setAttribute("aria-hidden",t?"false":"true"),s&&(t?(e.classList.add(r),e.classList.remove(i)):(e.classList.remove(r),e.classList.add(i)))}static disableElement(e,t=!0){(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLButtonElement)&&(e.disabled=t)}static disableRadioGroup(e,t=!0){Array.from(e).forEach((e=>{if(e instanceof HTMLInputElement){e.disabled=t;const n=e.closest(".radio-option");n&&(t?n.classList.add("disabled"):n.classList.remove("disabled"))}}));const n=document.querySelector(".radio-group");n&&(t?n.classList.add("disabled"):n.classList.remove("disabled"))}static updateErrorElement(e,t){e.textContent=t,e.style.display=t?"block":"none",e.setAttribute("aria-hidden",t?"false":"true"),t?(e.classList.add("error-visible"),e.classList.remove("error-hidden")):(e.classList.remove("error-visible"),e.classList.add("error-hidden"))}static debounce(e,t,n={}){let s;return function(...r){const i=this;if(n.immediate)return void e.apply(i,r);clearTimeout(s),s=window.setTimeout((function(){s=void 0,e.apply(i,r)}),t)}}static escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}class a{constructor(e){t(this,"container"),t(this,"apiBaseUrl"),t(this,"authStatusUrl"),t(this,"githubAuthUrl"),t(this,"logoutUrl"),this.container=e,this.apiBaseUrl="",this.authStatusUrl=this.apiBaseUrl+"/api/auth/status",this.githubAuthUrl=this.apiBaseUrl+"/api/auth/callback/github",this.logoutUrl=this.apiBaseUrl+"/api/auth/logout"}async render(){const e=await this.checkAuthStatus();e.isAuthenticated?this.renderWelcomeMessage(e.user):this.renderLoginOptions()}async checkAuthStatus(){try{const n=(new Date).getTime(),s=`${this.authStatusUrl}?t=${n}`,r=await fetch(s,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok){try{await r.text()}catch(e){}return{isAuthenticated:!1}}const i=r.headers.get("content-type");if(!i||!i.includes("application/json"))return{isAuthenticated:!1};try{return await r.json()}catch(t){return{isAuthenticated:!1}}}catch(n){return{isAuthenticated:!1}}}renderLoginOptions(){const e=document.createElement("div");e.className="landing-page",e.innerHTML=`\n      <div class="landing-container">\n        <h1>Contact Form</h1>\n        <p>Please choose how you would like to continue:</p>\n\n        <div class="landing-buttons">\n          <a href="${this.githubAuthUrl}" class="btn btn-primary">\n            Sign in with GitHub\n          </a>\n\n          <button id="continue-without-signin" class="btn btn-secondary">\n            Continue without signing in\n          </button>\n        </div>\n      </div>\n    `,this.container.innerHTML="",this.container.appendChild(e);const t=document.getElementById("continue-without-signin");t&&t.addEventListener("click",(()=>{this.showContactForm()}))}renderWelcomeMessage(e){const t=document.createElement("div");t.className="landing-page",t.innerHTML=`\n      <div class="landing-container">\n        <h1>Welcome, ${i.escapeHTML(e.name||e.email)}</h1>\n        <p>${e.isAdmin?"You have admin access.":"You are logged in."}</p>\n\n        <div class="landing-buttons">\n          <button id="continue-to-form" class="btn btn-primary">\n            Continue to Contact Form\n          </button>\n\n          ${e.isAdmin?`\n            <a href="${this.apiBaseUrl}/api/submissions">\n              View Submissions\n            </a>\n          `:""}\n\n          <button id="sign-out" class="btn btn-outline">\n            Sign Out\n          </button>\n        </div>\n      </div>\n    `,this.container.innerHTML="",this.container.appendChild(t);const n=document.getElementById("continue-to-form");n&&n.addEventListener("click",(()=>{this.showContactForm()}));const s=document.getElementById("sign-out");null==s||s.addEventListener("click",(async()=>{try{(await fetch(this.logoutUrl,{method:"GET",credentials:"include"})).ok&&window.location.reload()}catch(e){}}))}showContactForm(){this.container.innerHTML="";const e=new Event("showContactForm");document.dispatchEvent(e)}}class o{constructor(){t(this,"activeErrors",new Map)}showError(e,t,n="default"){i.showError(e,t),t?this.trackError(e,n):this.clearError(e,n)}trackError(e,t){var n;this.activeErrors.has(t)||this.activeErrors.set(t,new Set),null==(n=this.activeErrors.get(t))||n.add(e)}clearError(e,t){const n=this.activeErrors.get(t);n&&(n.delete(e),0===n.size&&this.activeErrors.delete(t))}clearErrorGroup(e){const t=this.activeErrors.get(e);t&&(t.forEach((e=>{i.showError(e,"")})),this.activeErrors.delete(e))}clearAllErrors(){for(const e of this.activeErrors.keys())this.clearErrorGroup(e)}hasErrors(e="default"){const t=this.activeErrors.get(e);return!!t&&t.size>0}getErrorCount(e="default"){var t;return(null==(t=this.activeErrors.get(e))?void 0:t.size)||0}}class l{renderForm(){return document.body.innerHTML='\n      <main class="container">\n        <form id="contact-form" class="contact-form" novalidate aria-label="Contact form">\n          <h1>Contact Us</h1>\n\n          <div class="name-fields-container">\n            <div class="form-group">\n              <label class="form-label" for="first-name">\n                <span class="label-text">First Name&nbsp;</span>\n                <span class="required" aria-hidden="true">*</span>\n              </label>\n              <input\n                type="text"\n                id="first-name"\n                name="first-name"\n                aria-required="true"\n                aria-describedby="first-name-error"\n              >\n              <span id="first-name-error" class="error-message" role="alert"></span>\n            </div>\n\n            <div class="form-group">\n              <label class="form-label" for="last-name">\n                <span class="label-text">Last Name&nbsp;</span>\n                <span class="required" aria-hidden="true">*</span>\n              </label>\n              <input\n                type="text"\n                id="last-name"\n                name="last-name"\n                aria-required="true"\n                aria-describedby="last-name-error"\n              >\n              <span id="last-name-error" class="error-message" role="alert"></span>\n            </div>\n          </div>\n\n          <div class="form-group">\n            <label class="form-label" for="email">\n              <span class="label-text">Email Address&nbsp;</span>\n              <span class="required" aria-hidden="true">*</span>\n            </label>\n            <input\n              type="email"\n              id="email"\n              name="email"\n              aria-required="true"\n              aria-describedby="email-error"\n            >\n            <span id="email-error" class="error-message" role="alert"></span>\n          </div>\n\n          <div class="form-group">\n            <fieldset class="radio-group" aria-describedby="query-type-error">\n              <legend id="label-legend">\n                <span class="label-text" id="query-type-label">Query Type&nbsp;</span>\n                <span class="required" aria-hidden="true">*</span>\n              </legend>\n              <div class="radio-options-container">\n                <div class="radio-option" id="radio-option-general">\n                  <input\n                    type="radio"\n                    id="query-general"\n                    name="query-type"\n                    value="general"\n                    aria-required="true"\n                    aria-describedby="query-type-error"\n                  >\n                  <label for="query-general">General Enquiry</label>\n                </div>\n                <div class="radio-option" id="radio-option-support">\n                  <input\n                    type="radio"\n                    id="query-support"\n                    name="query-type"\n                    value="support"\n                    aria-required="true"\n                    aria-describedby="query-type-error"\n                  >\n                  <label for="query-support">Support Request</label>\n                </div>\n              </div>\n              <span id="query-type-error" class="error-message" role="alert"></span>\n            </fieldset>\n          </div>\n\n          <div class="form-group">\n            <label class="form-label" for="message">\n              <span class="label-text">Message&nbsp;</span>\n              <span class="required" aria-hidden="true">*</span>\n            </label>\n            <textarea\n              id="message"\n              name="message"\n              aria-required="true"\n              aria-describedby="message-error"\n            ></textarea>\n            <span id="message-error" class="error-message" role="alert"></span>\n          </div>\n\n          <div class="form-group">\n            <div class="checkbox-container" role="group" aria-describedby="consent-error">\n              <input\n                type="checkbox"\n                id="consent"\n                name="consent"\n                aria-required="true"\n                aria-describedby="consent-error"\n              >\n              <label for="consent">\n                <span class="label-text">I consent to being contacted by the team&nbsp;</span>\n                <span class="required" aria-hidden="true">*</span>\n              </label>\n              <span id="consent-error" class="error-message" role="alert"></span>\n            </div>\n          </div>\n\n          <button type="submit" aria-label="Submit contact form">Submit</button>\n        </form>\n      </main>\n    ',document.querySelector(".contact-form")}}class c{constructor(e){t(this,"toastService"),t(this,"apiUrl"),this.toastService=e;const n=window.location.origin;this.apiUrl=`${n||"http://localhost:3001"}/api/submissions`}formatFormData(e){const t=["firstName","lastName","email","message"];for(const n of t)if(!(n in e)||""===e[n].trim())throw new Error(`Missing required field: ${n}`);return{submission:{...e,timestamp:(new Date).toISOString()}}}async submitForm(e,t){try{const n=this.formatFormData(e);await new Promise(((e,s)=>{const r=setTimeout((async()=>{try{const s=await fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),signal:t});if(!s.ok){const e=await s.text();throw new Error(`API error: ${s.status} - ${e}`)}await s.json().catch((()=>({})));e(null)}catch(r){s(r)}}),1500);t&&t.addEventListener("abort",(()=>{clearTimeout(r),s(new DOMException("Form submission aborted","AbortError"))}))}))}catch(n){throw n}}showSuccessMessage(){this.toastService.showFormSubmissionSuccess("Message Sent!","Thanks for completing the form. We'll be in touch soon!")}}class d{showSuccess(e){n({text:e,duration:5e3,gravity:"top",position:"center",avatar:"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='20'%20height='21'%20fill='none'%20viewBox='0%200%2020%2021'%3e%3cpath%20fill='%23fff'%20d='M14.28%207.72a.748.748%200%200%201%200%201.06l-5.25%205.25a.748.748%200%200%201-1.06%200l-2.25-2.25a.75.75%200%201%201%201.06-1.06l1.72%201.72%204.72-4.72a.75.75%200%200%201%201.06%200Zm5.47%202.78A9.75%209.75%200%201%201%2010%20.75a9.76%209.76%200%200%201%209.75%209.75Zm-1.5%200A8.25%208.25%200%201%200%2010%2018.75a8.26%208.26%200%200%200%208.25-8.25Z'/%3e%3c/svg%3e",className:"toast-success",escapeMarkup:!1,stopOnFocus:!0,style:{background:"hsl(187, 24%, 22%)",color:"hsl(0, 0%, 100%)",boxShadow:"0 10px 30px rgba(33, 33, 33, 0.1)",borderRadius:"4px",fontFamily:"Karla, sans-serif",top:"16px"},offset:{x:0,y:16}}).showToast()}showFormSubmissionSuccess(e,t){const n=`\n      <div class="toast-success-wrapper">\n        <strong>${e}</strong>\n        <div class="toast-success-content">\n          ${t}\n        </div>\n      </div>\n    `;this.showSuccess(n)}}class u{validateField(e,t){let n=!0,i="";switch(e){case"firstName":case"lastName":case"message":n=s.sanitize(t.value.trim()).length>0,i=n?"":"This field is required";break;case"email":const e=s.sanitize(t.value);e.trim()?(n=r.isEmail(e),i=n?"":"Please enter a valid email address"):(n=!1,i="This field is required");break;case"queryType":n=""!==s.sanitize(t.value),i=n?"":"Please select a query type";break;case"consent":n=t.checked,i=n?"":"To submit this form, please consent to being contacted"}return{isValid:n,errorMessage:i}}}const m="input",h="blur",p="change",b="submit",f="first-name",g="last-name",v="email",E="message",y="consent",w="query-type",F="Submit";class L{constructor(e,n,s){t(this,"form"),t(this,"elements"),t(this,"submitButton"),t(this,"formRenderer"),t(this,"errorHandler"),t(this,"abortController"),t(this,"currentFormElements",new Set),t(this,"isActive",!1),t(this,"elementToFieldNameMap",new Map),this.formRenderer=e,this.errorHandler=n,this.abortController=s||new AbortController}isExternalController(){var e;return(null==(e=this.abortController)?void 0:e.signal)&&!this.abortController.signal.aborted}createForm(){return this.form=this.formRenderer.renderForm(),this.setupElements(),this.setInitialFocus(),this.isActive=!0,this.form}setupElements(){this.initializeFormElements(),this.initializeSubmitButton(),this.trackCurrentFormElements(),this.buildElementFieldNameMap()}initializeFormElements(){this.elements={firstName:i.getElementById(f),lastName:i.getElementById(g),email:i.getElementById(v),queryType:i.getElementByName(this.form,w),message:i.getElementById(E),consent:i.getElementById(y)}}initializeSubmitButton(){this.submitButton=this.form.querySelector("button")}trackCurrentFormElements(){this.currentFormElements.clear(),Object.values(this.elements).forEach((e=>{e instanceof HTMLElement?this.currentFormElements.add(e):e instanceof RadioNodeList&&Array.from(e).forEach((e=>{e instanceof HTMLElement&&this.currentFormElements.add(e)}))}))}buildElementFieldNameMap(){this.elementToFieldNameMap.clear(),Object.entries(this.elements).forEach((([e,t])=>{t instanceof HTMLElement?this.elementToFieldNameMap.set(t,e):t instanceof RadioNodeList&&Array.from(t).forEach((t=>{t instanceof HTMLElement&&this.elementToFieldNameMap.set(t,e)}))}))}setInitialFocus(){this.elements.firstName&&this.elements.firstName.focus()}setupEventListeners(e,t){this.addSubmitEventListener(e),this.setupEventDelegation(t),this.setupDirectEventListeners(t)}addSubmitEventListener(e){this.form.addEventListener(b,e,{signal:this.abortController.signal})}createDebouncedHandler(e){const t="undefined"!=typeof process&&!1;return i.debounce(e,300,{immediate:t})}setupEventDelegation(e){const t=this.createDebouncedHandler((t=>this.handleDelegatedEvent(t,e)));this.form.addEventListener(m,t,{signal:this.abortController.signal}),this.form.addEventListener(h,(t=>this.handleDelegatedEvent(t,e)),{signal:this.abortController.signal,capture:!0}),this.form.addEventListener(p,(t=>this.handleDelegatedEvent(t,e)),{signal:this.abortController.signal})}setupDirectEventListeners(e){Object.entries(this.elements).forEach((([t,n])=>{if("queryType"===t&&n instanceof RadioNodeList)Array.from(n).forEach((n=>{n instanceof HTMLInputElement&&n.addEventListener(p,(()=>{this.isActive&&e(t)}),{signal:this.abortController.signal})}));else if(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement){const s=this.createDebouncedHandler((()=>{this.isActive&&e(t)}));n.addEventListener(m,s,{signal:this.abortController.signal}),n.addEventListener(h,(()=>{this.isActive&&e(t)}),{signal:this.abortController.signal})}}))}handleDelegatedEvent(e,t){if(!this.isActive)return;const n=e.target;if(!n||!(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement||n instanceof HTMLSelectElement)||!this.currentFormElements.has(n))return;const s=this.getFieldNameFromElement(n);s&&t(s)}getFieldNameFromElement(e){return this.elementToFieldNameMap.get(e)||null}getFormElements(){return this.elements}getForm(){return this.form}getSubmitButton(){return this.submitButton}getAbortSignal(){return this.abortController.signal}showFieldError(e,t){const n=this.elements[e],s=i.getErrorContainer(e,n);s&&this.errorHandler.showError(s,t)}disableSubmitButton(e){this.submitButton.disabled=!0,this.submitButton.textContent=e}resetSubmitButton(){this.submitButton.disabled=!1,this.submitButton.textContent=F}disableFormElements(){Object.values(this.elements).forEach((e=>{e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?i.disableElement(e,!0):e instanceof RadioNodeList&&i.disableRadioGroup(e,!0)}))}resetForm(){this.form.reset()}showFormError(e){this.errorHandler.showError(this.form,e)}cleanup(){this.isActive=!1,this.currentFormElements.clear(),this.elementToFieldNameMap.clear(),this.abortController&&"function"==typeof this.abortController.abort&&this.abortController.abort(),this.isExternalController()||(this.abortController=new AbortController)}}class S{constructor(e,n,s){t(this,"view"),t(this,"validator"),t(this,"submitter"),t(this,"elements"),this.validator=e,this.submitter=n,this.view=s}cleanup(){this.view.cleanup()}init(){try{this.view.createForm(),this.elements=this.view.getFormElements();const e=e=>this.handleSubmit(e),t=e=>this.validateField(e);this.view.setupEventListeners(e,t)}catch(e){throw e}}validateField(e){const t=this.elements[e],{isValid:n,errorMessage:s}=this.validator.validateField(e,t);return this.view.showFieldError(e,n?"":s),n}async handleSubmit(e){e.preventDefault(),this.view.getSubmitButton().disabled||this.validateAllFields()&&await this.submitForm()}validateAllFields(){let e=!0;return Object.keys(this.elements).forEach((t=>{const n=t;this.validateField(n)||(e=!1)})),e}async submitForm(){const e=this.view.getAbortSignal();if(!(null==e?void 0:e.aborted)){this.view.disableSubmitButton("Sending...");try{const t=this.collectFormData();await this.submitter.submitForm(t,e),this.handleSuccessfulSubmission()}catch(t){this.handleSubmissionError(t)}}}handleSubmissionError(e){e instanceof DOMException&&"AbortError"===e.name?this.view.resetSubmitButton():this.handleFailedSubmission(e)}collectFormData(){return{firstName:s.sanitize(this.elements.firstName.value),lastName:s.sanitize(this.elements.lastName.value),email:s.sanitize(this.elements.email.value),queryType:s.sanitize(this.elements.queryType.value),message:s.sanitize(this.elements.message.value),consent:this.elements.consent.checked}}handleSuccessfulSubmission(){this.submitter.showSuccessMessage(),this.view.disableFormElements(),this.view.resetForm(),this.view.disableSubmitButton("Sent")}handleFailedSubmission(e){Error,this.view.showFormError("Failed to send message. Please try again."),this.view.resetSubmitButton()}}class T{static create(e={}){const t=e.validator||new u,n=e.toastService||new d,s=e.errorHandler||new o,r=e.formRenderer||new l,i=e.view||new L(r,s,e.abortController),a=e.submitter||new c(n);return new S(t,a,i)}}const C=class e{constructor(){t(this,"contactForm",null),t(this,"appContainer",null),t(this,"landingPage",null),this.appContainer=document.getElementById("app")}static getInstance(){return e.instance||(e.instance=new e),e.instance}init(){this.cleanup(),this.appContainer&&(this.landingPage=new a(this.appContainer),this.landingPage.render(),document.addEventListener("showContactForm",(()=>{this.initContactForm()})),this.setupUnloadCleanup())}initContactForm(){this.contactForm=T.create(),this.contactForm.init()}cleanup(){this.contactForm&&(this.contactForm.cleanup(),this.contactForm=null)}setupUnloadCleanup(){window.addEventListener("beforeunload",(()=>{this.cleanup()}))}};t(C,"instance",null);let A=C;document.addEventListener("DOMContentLoaded",(()=>{A.getInstance().init()}));
